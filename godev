#!/bin/zsh
#
# -----------------------------------------------------------------------------
# Welcome to godev!
#
# This software is free and open source.
# Feel free to use, modify, and share it as you wish.
#
# (See full Apache 2.0 License at the end of this file)
# -----------------------------------------------------------------------------
#
# godev - Multi-Folder Development Tree Demystification Tool
#
# DESCRIPTION
#   Demystify your multi-folder development tree. Navigate projects instantly,
#   see Git activity at a glance, and make sense of complex development structures.
#
# REQUIREMENTS
#   This script REQUIRES ZSH (Z Shell) and will NOT work with Bash.
#   It uses ZSH-specific features such as:
#   - Array indexing and parameter expansion flags
#   - Advanced parameter substitution
#   - ZSH-specific array operations
#
# USAGE
#   godev <command> [options]
#
# COMMANDS
#   nav, n <pattern>     Navigate to project (default command)
#   status, s [options]   Show project activity status
#   list, l              List all projects
#   ai-status            Check AI development tools status
#   version, v           Show version
#   help, h              Show help
#
# EXAMPLES
#   godev nav react          # Navigate to react project
#   godev react              # Same (nav is default)
#   godev status             # Show all project statuses
#   godev status -f 7        # Show active in last 7 days
#   godev list               # List all projects
#   godev ai-status          # Check AI tools
# -----------------------------------------------------------------------------

VERSION="2.0.0"

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
MAGENTA='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
GRAY='\033[0;90m'
NC='\033[0m' # No Color

# Base projects directory (adjust according to your configuration)
DEV_BASE="${HOME}/DEV"

# Configuration
MAX_DEPTH=5  # Maximum depth for recursive search (0 = unlimited)
READONLY_MODE=true  # Set to false to allow directory creation (for testing)

# Show help
show_help() {
    cat << EOF
${WHITE}godev${NC} - Multi-Folder Development Tree Demystification Tool

${CYAN}USAGE:${NC}
    godev <command> [options]

${CYAN}COMMANDS:${NC}
    ${GREEN}nav, n${NC} <pattern>        Navigate to project (default command)
    ${GREEN}status, s${NC} [options]     Show project activity status
    ${GREEN}list, l${NC}                 List all projects
    ${GREEN}ai-status${NC}               Check AI development tools status
    ${GREEN}version, v${NC}              Show version
    ${GREEN}help, h${NC}                 Show this help

${CYAN}EXAMPLES:${NC}
    godev nav react          # Navigate to react project
    godev react              # Same (nav is default)
    godev status             # Show all project statuses
    godev status -f 7        # Show active in last 7 days
    godev list               # List all projects
    godev ai-status          # Check AI tools

${CYAN}NOTE:${NC}
    This tool works in ${YELLOW}readonly mode${NC} by default during testing.
    It will ${YELLOW}not modify${NC} your development folder structure.

EOF
}

# Main command dispatcher
main() {
    local command="$1"
    shift
    
    # If no command provided, default to nav (for backward compatibility)
    if [[ -z "$command" ]] || [[ "$command" == -* ]]; then
        # Check if it's a version or help flag
        case "$command" in
            -v|--version)
                echo "godev version $VERSION"
                exit 0
                ;;
            -h|--help)
                show_help
                exit 0
                ;;
            *)
                # Default to nav command
                nav_command "$command" "$@"
                return
                ;;
        esac
    fi
    
    case "$command" in
        nav|n|"")
            nav_command "$@"
            ;;
        status|s|stats)
            status_command "$@"
            ;;
        list|l)
            list_command "$@"
            ;;
        ai-status|ai)
            ai_status_command "$@"
            ;;
        version|v)
            echo "godev version $VERSION"
            ;;
        help|h)
            show_help
            ;;
        *)
            echo -e "${RED}Unknown command: $command${NC}" >&2
            echo "Run 'godev help' for usage"
            exit 1
            ;;
    esac
}

# Placeholder commands (to be implemented)
nav_command() {
    echo -e "${YELLOW}Command 'nav' is being implemented...${NC}"
    echo "This will allow navigation to projects."
    echo "Currently in readonly mode - no directory modifications."
}

status_command() {
    echo -e "${YELLOW}Command 'status' is being implemented...${NC}"
    echo "This will show project activity status."
}

list_command() {
    echo -e "${YELLOW}Command 'list' is being implemented...${NC}"
    echo "This will list all projects."
}

ai_status_command() {
    echo -e "${YELLOW}Command 'ai-status' is being implemented...${NC}"
    echo "This will check AI development tools status."
}

# Run main function
main "$@"

# -----------------------------------------------------------------------------
# LICENSE (Apache 2.0)
#
# Copyright 2024 Augusto Sosa Escalada
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# -----------------------------------------------------------------------------

